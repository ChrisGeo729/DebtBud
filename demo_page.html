<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="DebtBud Dashboard Demo">
  <title>DebtBud Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .hidden-section {
      display: none;
    }
    .active-tab {
      background-color: #2563eb;
      color: white;
    }
    #chatbot-container {
          position: fixed;
          bottom: 1rem;
          right: 1rem;
          width: 300px;
          max-height: 400px;
          background-color: #1a1a1a;
          border: 1px solid #333;
          border-radius: 10px;
          overflow: hidden;
          display: none;
          flex-direction: column;
          z-index: 1000;
        }
      
        #chatbot-header {
          background-color: #333;
          color: white;
          padding: 10px;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }
      
        #chatbot-messages {
          flex-grow: 1;
          padding: 10px;
          overflow-y: auto;
          background-color: #222;
        }
      
        #chatbot-input-container {
          display: flex;
          border-top: 1px solid #333;
          padding: 10px;
          background-color: #1a1a1a;
        }
      
        #chatbot-input {
          flex-grow: 1;
          padding: 8px;
          border-radius: 5px;
          border: 1px solid #444;
          background-color: #333;
          color: white;
        }
      
        #chatbot-send {
          margin-left: 8px;
          padding: 8px 12px;
          background-color: #333cb4;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
        }
      
        #chatbot-button {
          position: fixed;
          bottom: 1rem;
          right: 1rem;
          background-color: #434bb7;
          color: white;
          padding: 12px;
          border-radius: 50%;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
          cursor: pointer;
          z-index: 999;
        }
        #forum {
  display: block;
  color: white;
}
.bg-gray-900 {
  background-color: #1a202c;
}
.text-blue-700 {
  color: #2b6cb0;
}


    .interactive:hover {
      transform: scale(1.05);
      transition: transform 0.2s ease-in-out;
    }
    .active-tab {
      background-color: #2563eb;
      color: white;
      font-weight: bold;
    }
    .interactive:hover {
  transform: translateY(-5px);
  transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
  box-shadow: 0 10px 15px rgba(0, 0, 0, 0.3);
}

.shadow-lg {
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.hover\:shadow-xl:hover {
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
}
#onboarding-overlay {
  animation: fadeIn 0.3s ease-in-out;
}

.notification {
  background-color: #1a1a1a;
  color: white;
  border: 1px solid #444;
  padding: 10px 20px;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  animation: fadeInOut 5s ease-in-out;
  margin-bottom: 10px;
}

.notification.warning {
  border-left: 5px solid #ffc107; /* Yellow for warnings */
}

.notification.danger {
  border-left: 5px solid #f44336; /* Red for danger */
}

@keyframes fadeInOut {
  0% { opacity: 0; transform: translateY(-20px); }
  10% { opacity: 1; transform: translateY(0); }
  90% { opacity: 1; }
  100% { opacity: 0; transform: translateY(-20px); }
}


  </style>
</head>
<body class="bg-gray-900 text-white">
  <!-- Header -->
  <!-- Header -->
  <header class="bg-black text-white px-6 py-4 flex justify-between">
    <a href="#" class="text-2xl font-bold">DebtBud Dashboard</a>
    <nav class="flex space-x-4">
      <button id="overview-tab" class="px-4 py-2 rounded hover:bg-blue-600 active-tab" onclick="showSection('overview')">Account Overview</button>
      <button id="budgeting-tab" class="px-4 py-2 rounded hover:bg-blue-600" onclick="showSection('budgeting')">Budgeting</button>
      <button id="calculator-tab" class="px-4 py-2 rounded hover:bg-blue-600" onclick="showSection('calculator')">Loan Calculator</button>
      <button id="forum-tab" class="px-4 py-2 rounded hover:bg-blue-600" onclick="showSection('forum')">Community Forum</button>
      <button onclick="showOverlay()" class="px-4 py-2 rounded hover:bg-blue-600">Help</button>

    </nav>
  </header>
  <!-- Onboarding Overlay -->
<div id="onboarding-overlay" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
    <div class="bg-gray-900 text-white p-8 rounded-lg max-w-2xl w-full">
      <h2 class="text-2xl font-bold mb-4">Welcome to DebtBud Demo!</h2>
      <p class="mb-4">This demo showcases the key features of DebtBud:</p>
      <ul class="list-disc pl-5 mb-4">
        <li><strong>Account Overview:</strong> Track income, expenses, and remaining balance.</li>
        <li><strong>Budgeting:</strong> Set goals and monitor your progress.</li>
        <li><strong>Loan Calculator:</strong> Plan and analyze loan repayments.</li>
        <li><strong>Community Forum:</strong> Engage with peers and share financial tips.</li>
      </ul>
      <button onclick="closeOverlay()" class="bg-blue-600 hover:bg-blue-500 px-6 py-2 rounded text-white">Got it!</button>
    </div>
  </div>
  <div id="notification-container" class="fixed top-4 right-4 space-y-4 z-50">
    <!-- Notifications will be dynamically added here -->
  </div>
  <button
    id="reset-notifications"
    class="fixed bottom-4 right-4 bg-red-600 text-white py-2 px-4 rounded shadow-lg hover:bg-red-500"
  >
    Reset Notifications
  </button>
  
  
  

  <!-- Main Content -->
  <main class="flex-grow p-8">
    <section id="overview-section" class="py-16 px-8 bg-gray-900 text-white">
        <h2 class="text-4xl font-bold text-center text-blue-600 mb-10">Account Overview</h2>
      
        <!-- Statement Summary -->
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg mb-10">
          <h3 class="text-xl font-semibold text-gray-200 mb-4">Statement Summary</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="text-center">
              <p class="text-lg font-semibold text-gray-400">Total Income</p>
              <p id="total-income" class="text-2xl font-bold text-green-400">$0</p>
            </div>
            <div class="text-center">
              <p class="text-lg font-semibold text-gray-400">Total Expenses</p>
              <p id="total-expenses" class="text-2xl font-bold text-red-400">$0</p>
            </div>
            <div class="text-center">
              <p class="text-lg font-semibold text-gray-400">Remaining Balance</p>
              <p id="remaining-balance" class="text-2xl font-bold text-yellow-400">$0</p>
            </div>
          </div>
        </div>
      
        <!-- Bank Statement -->
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
          <h3 class="text-xl font-semibold text-gray-200 mb-4">Bank Statement</h3>
          <div class="overflow-x-auto">
            <table class="w-full table-auto border-collapse">
              <thead>
                <tr class="bg-gray-700 text-left">
                  <th class="px-4 py-2 text-blue-400">Date/Time</th>
                  <th class="px-4 py-2 text-blue-400">Category</th>
                  <th class="px-4 py-2 text-blue-400">Description</th>
                  <th class="px-4 py-2 text-blue-400">Amount</th>
                </tr>
              </thead>
              <tbody id="statement-rows">
                <!-- Transactions dynamically rendered here -->
              </tbody>
            </table>
          </div>
        </div>
      
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg mt-8">
            <h3 class="text-xl font-semibold text-gray-200 mb-4">Add a New Transaction</h3>
            <form id="add-transaction-form" onsubmit="addNewTransaction(event)" class="space-y-6">
              <div>
                <label for="transaction-category" class="block text-sm font-medium text-gray-400">Category</label>
                <select
                  id="transaction-category"
                  name="category"
                  required
                  class="w-full p-3 bg-gray-700 text-white rounded focus:ring focus:ring-blue-500"
                >
                  <option value="Income">Income</option>
                  <option value="Rent">Rent</option>
                  <option value="Groceries">Groceries</option>
                  <option value="Entertainment">Entertainment</option>
                  <option value="Transportation">Transportation</option>
                  <option value="Savings">Savings</option>
                </select>
              </div>
              <div>
                <label for="transaction-description" class="block text-sm font-medium text-gray-400">Description</label>
                <input
                  type="text"
                  id="transaction-description"
                  name="description"
                  placeholder="Enter transaction description"
                  required
                  class="w-full p-3 bg-gray-700 text-white rounded focus:ring focus:ring-blue-500"
                />
              </div>
              <div>
                <label for="transaction-amount" class="block text-sm font-medium text-gray-400">Amount</label>
                <input
                  type="number"
                  id="transaction-amount"
                  name="amount"
                  placeholder="Enter transaction amount"
                  required
                  step="0.01"
                  class="w-full p-3 bg-gray-700 text-white rounded focus:ring focus:ring-blue-500"
                />
              </div>
              <button
                type="submit"
                class="w-full bg-blue-600 text-white py-3 rounded-full hover:bg-blue-500 transition"
              >
                Add Transaction
              </button>
            </form>
          </div>
          
      </section>
      
      
    <!-- Budgeting Section -->
    <section id="budgeting-section" class="py-16 px-8 bg-gradient-to-b from-gray-800 to-black text-white">
        <h2 class="text-5xl font-extrabold text-center text-blue-500 mb-10">Budgeting Tools</h2>
      
        <!-- Grid Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- Left: Budget Goals Form -->
          <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
            <h3 class="text-xl font-semibold text-gray-200 mb-4">Set Your Budget Goals</h3>
            <form id="budget-goals-form" onsubmit="submitGoals(event)" class="space-y-6">
              <!-- <div>
                <label for="income-goal" class="block text-sm font-medium text-gray-400">Income Goal</label>
                <input
                  type="number"
                  id="income-goal"
                  name="income-goal"
                  placeholder="Enter income goal"
                  required
                  class="w-full p-3 bg-gray-700 text-white rounded focus:ring focus:ring-blue-500"
                />
              </div> -->
              <div>
                <label for="rent-goal" class="block text-sm font-medium text-gray-400">Rent Goal</label>
                <input
                  type="number"
                  id="rent-goal"
                  name="rent-goal"
                  placeholder="Enter rent goal"
                  required
                  class="w-full p-3 bg-gray-700 text-white rounded focus:ring focus:ring-blue-500"
                />
              </div>
              <div>
                <label for="groceries-goal" class="block text-sm font-medium text-gray-400">Groceries Goal</label>
                <input
                  type="number"
                  id="groceries-goal"
                  name="groceries-goal"
                  placeholder="Enter groceries goal"
                  required
                  class="w-full p-3 bg-gray-700 text-white rounded focus:ring focus:ring-blue-500"
                />
              </div>
              <div>
                <label for="entertainment-goal" class="block text-sm font-medium text-gray-400">Entertainment Goal</label>
                <input
                  type="number"
                  id="entertainment-goal"
                  name="entertainment-goal"
                  placeholder="Enter entertainment goal"
                  required
                  class="w-full p-3 bg-gray-700 text-white rounded focus:ring focus:ring-blue-500"
                />
              </div>
              <div>
                <label for="transportation-goal" class="block text-sm font-medium text-gray-400">Transportation Goal</label>
                <input
                  type="number"
                  id="transportation-goal"
                  name="transportation-goal"
                  placeholder="Enter transportation goal"
                  required
                  class="w-full p-3 bg-gray-700 text-white rounded focus:ring focus:ring-blue-500"
                />
              </div>
              <div>
                <label for="savings-goal" class="block text-sm font-medium text-gray-400">Savings Goal</label>
                <input
                  type="number"
                  id="savings-goal"
                  name="savings-goal"
                  placeholder="Enter savings goal"
                  required
                  class="w-full p-3 bg-gray-700 text-white rounded focus:ring focus:ring-blue-500"
                />
              </div>
              <button
                type="submit"
                class="w-full bg-blue-600 text-white py-3 rounded-full hover:bg-blue-500 transition"
              >
                Save Goals
              </button>
            </form>
          </div>
          
      
          <!-- Right: AI Advice -->
          <div id="advice-output" class="bg-gray-800 p-8 rounded-lg shadow-lg hover:shadow-xl transition">
            <h3 class="text-2xl font-semibold mb-6">AI Advice</h3>
            <p id="advice-text" class="text-gray-300">Your advice will appear here after syncing your data.</p>
          </div>
        </div>
      
        <!-- Bottom Section: Progress Charts -->
        <div id="charts-container" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-8 mt-12">
          <!-- Rent Chart -->
          <div class="flex flex-col items-center bg-gray-700 p-6 rounded-lg shadow-lg hover:shadow-xl transition">
            <p id="chart-rent-title" class="text-xl font-semibold mb-4">Rent</p>
            <canvas id="chart-rent" class="w-full h-auto" style="max-width: 200px; max-height: 200px;"></canvas>
          </div>
          <!-- Groceries Chart -->
          <div class="flex flex-col items-center bg-gray-700 p-6 rounded-lg shadow-lg hover:shadow-xl transition">
            <p id="chart-groceries-title" class="text-xl font-semibold mb-4">Groceries</p>
            <canvas id="chart-groceries" class="w-full h-auto" style="max-width: 200px; max-height: 200px;"></canvas>
          </div>
          <!-- Entertainment Chart -->
          <div class="flex flex-col items-center bg-gray-700 p-6 rounded-lg shadow-lg hover:shadow-xl transition">
            <p id="chart-entertainment-title" class="text-xl font-semibold mb-4">Entertainment</p>
            <canvas id="chart-entertainment" class="w-full h-auto" style="max-width: 200px; max-height: 200px;"></canvas>
          </div>
          <!-- Transportation Chart -->
          <div class="flex flex-col items-center bg-gray-700 p-6 rounded-lg shadow-lg hover:shadow-xl transition">
            <p id="chart-transportation-title" class="text-xl font-semibold mb-4">Transportation</p>
            <canvas id="chart-transportation" class="w-full h-auto" style="max-width: 200px; max-height: 200px;"></canvas>
          </div>
          <!-- Savings Chart -->
          <div class="flex flex-col items-center bg-gray-700 p-6 rounded-lg shadow-lg hover:shadow-xl transition">
            <p id="chart-savings-title" class="text-xl font-semibold mb-4">Savings</p>
            <canvas id="chart-savings" class="w-full h-auto" style="max-width: 200px; max-height: 200px;"></canvas>
          </div>
        </div>
        <div id="onboarding-overlay" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
            <div class="bg-gray-900 text-white p-8 rounded-lg max-w-2xl w-full">
              <h2 class="text-2xl font-bold mb-4">Welcome to DebtBud Demo!</h2>
              <p class="mb-4">This demo showcases the key features of DebtBud:</p>
              <ul class="list-disc pl-5 mb-4">
                <li><strong>Account Overview:</strong> Track income, expenses, and remaining balance.</li>
                <li><strong>Budgeting:</strong> Set goals and monitor your progress.</li>
                <li><strong>Loan Calculator:</strong> Plan and analyze loan repayments.</li>
                <li><strong>Community Forum:</strong> Engage with peers and share financial tips.</li>
              </ul>
              <button onclick="closeOverlay()" class="bg-blue-600 hover:bg-blue-500 px-6 py-2 rounded text-white">Got it!</button>
            </div>
          </div>
          
      </section>
      
    
        <script>
        const activeNotifications = new Set();

    // Show the onboarding overlay
function showOverlay() {
  document.getElementById('onboarding-overlay').classList.remove('hidden');
}

// Close the onboarding overlay
function closeOverlay() {
  document.getElementById('onboarding-overlay').classList.add('hidden');
  sessionStorage.setItem('seenOnboarding', 'true'); // Only dismiss for the current session
}

// Always show the overlay on page load unless dismissed
window.addEventListener('load', () => {
    const hasSeen = sessionStorage.getItem('seenOnboarding');
    if (!hasSeen) {
        showOverlay(); // Call this function to display the overlay
    }
});



            // Centralized transaction data
// Centralized transaction data
const transactions = [
  { id: 1, date: "2024-12-01", category: "Income", description: "Salary", amount: 1500 },
  { id: 2, date: "2024-12-02", category: "Rent", description: "Monthly rent payment", amount: -800 },
  { id: 3, date: "2024-12-03", category: "Groceries", description: "Supermarket shopping", amount: -225 },
  { id: 4, date: "2024-12-04", category: "Entertainment", description: "Movie night", amount: -50 },
  { id: 5, date: "2024-12-05", category: "Transportation", description: "Bus fare", amount: -80 },
  { id: 6, date: "2024-12-06", category: "Savings", description: "Savings contribution", amount: -50 },
];

// Budget goals object
let budgetGoals = {
  income: 1500, // Hardcoded income goal
};

// Load Budget Goals from Local Storage
function loadBudgetGoals() {
  const savedGoals = localStorage.getItem("budgetGoals");
  if (savedGoals) {
    const parsedGoals = JSON.parse(savedGoals);
    budgetGoals = {
      ...budgetGoals, // Keep hardcoded income goal
      ...parsedGoals, // Load other goals from localStorage
    };

    // Populate form inputs with saved goals
    document.getElementById("rent-goal").value = budgetGoals.rent || 0;
    document.getElementById("groceries-goal").value = budgetGoals.groceries || 0;
    document.getElementById("entertainment-goal").value = budgetGoals.entertainment || 0;
    document.getElementById("transportation-goal").value = budgetGoals.transportation || 0;
    document.getElementById("savings-goal").value = budgetGoals.savings || 0;
  } else {
    // Initialize default goals if nothing is saved
    budgetGoals = {
      ...budgetGoals, // Keep hardcoded income goal
      rent: 0,
      groceries: 0,
      entertainment: 0,
      transportation: 0,
      savings: 0,
    };
  }
}

// Save Budget Goals to Local Storage
function saveBudgetGoals() {
  const goalsToSave = { ...budgetGoals };
  delete goalsToSave.income; // Don't save hardcoded income goal
  localStorage.setItem("budgetGoals", JSON.stringify(goalsToSave));
}

// Handle budget goal submission
// Handle budget goal submission
function submitGoals(event) {
  event.preventDefault();

  // Get budget goals from form inputs
  budgetGoals = {
    ...budgetGoals, // Preserve hardcoded income goal
    rent: parseFloat(document.getElementById("rent-goal").value) || 0,
    groceries: parseFloat(document.getElementById("groceries-goal").value) || 0,
    entertainment: parseFloat(document.getElementById("entertainment-goal").value) || 0,
    transportation: parseFloat(document.getElementById("transportation-goal").value) || 0,
    savings: parseFloat(document.getElementById("savings-goal").value) || 0,
  };

  // Save to localStorage
  saveBudgetGoals();

  // Render charts with updated goals
  renderBudgetingProgress();

  // Trigger notifications
  checkNotifications();

  alert("Budget goals saved! AI advice updated.");
  updateDashboard();
}



// Render Account Overview Section
// Update after rendering Account Overview
function renderAccountOverview() {
  const statementRows = document.getElementById("statement-rows");
  statementRows.innerHTML = "";

  let totalIncome = 0;
  let totalExpenses = 0;

  transactions.forEach((transaction) => {
    const row = document.createElement("tr");
    row.classList.add("border-b", "border-gray-600");

    // Update totals
    if (transaction.amount > 0) {
      totalIncome += transaction.amount;
    } else {
      totalExpenses += Math.abs(transaction.amount);
    }

    row.innerHTML = `
      <td class="px-4 py-2 text-gray-300">${transaction.date}</td>
      <td class="px-4 py-2 text-gray-300">${transaction.category}</td>
      <td class="px-4 py-2 text-gray-300">${transaction.description}</td>
      <td class="px-4 py-2 ${
        transaction.amount > 0 ? "text-green-400" : "text-red-400"
      }">${transaction.amount > 0 ? "+" : "-"} ${Math.abs(transaction.amount).toFixed(2)}</td>
    `;

    statementRows.appendChild(row);
  });

  // Update summary totals
  document.getElementById("total-income").textContent = `€${totalIncome.toFixed(2)}`;
  document.getElementById("total-expenses").textContent = `€${totalExpenses.toFixed(2)}`;
  document.getElementById("remaining-balance").textContent = `€${(totalIncome - totalExpenses).toFixed(2)}`;
}



// Update after rendering Budgeting Progress
function renderBudgetingProgress() {
  const expenses = calculateCurrentExpenses();

  // Update progress charts
  updateProgressCharts(expenses);
}


// Calculate current expenses from centralized transaction data
function calculateCurrentExpenses() {
  const expenses = {
    income: 0,
    rent: 0,
    groceries: 0,
    entertainment: 0,
    transportation: 0,
    savings: 0,
  };

  transactions.forEach((transaction) => {
    const category = transaction.category.toLowerCase();
    if (transaction.amount < 0 && expenses.hasOwnProperty(category)) {
      // Only count negative amounts as expenses
      expenses[category] += Math.abs(transaction.amount);
    } else if (transaction.amount > 0 && category === "income") {
      // Count positive amounts as income
      expenses.income += transaction.amount;
    }
  });

  return expenses;
}

// Update progress charts dynamically
function updateProgressCharts(expenses) {
  const categories = Object.keys(budgetGoals);

  categories.forEach((category) => {
    const goal = budgetGoals[category];
    const spent = expenses[category] || 0;

    const percentage = goal > 0 ? Math.round((spent / goal) * 100) : 0;
    const remaining = 100 - percentage;

    const color = getColorByPercentage(percentage);
    const canvasId = `chart-${category}`;
    const ctx = document.getElementById(canvasId)?.getContext("2d");

    if (!ctx) return;

    // Update the chart title with the percentage
    const titleElement = document.querySelector(`#chart-${category}-title`);
    if (titleElement) {
      titleElement.innerHTML = `${category.charAt(0).toUpperCase() + category.slice(1)} (${percentage}%)`;
    }

    // Destroy any existing chart before rendering a new one
    if (ctx.chart) {
      ctx.chart.destroy();
    }

    ctx.chart = new Chart(ctx, {
      type: "doughnut",
      data: {
        datasets: [
          {
            data: [percentage, remaining],
            backgroundColor: [color, "#e0e0e0"],
            hoverBackgroundColor: [color, "#e0e0e0"],
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        cutout: "75%",
        plugins: {
          legend: { display: false },
        },
      },
    });
  });
}

// Get color by percentage
function getColorByPercentage(percentage) {
  if (percentage <= 9) {
    return "#2563eb"; // Blue
  } else if (percentage <= 49) {
    return "#4caf50"; // Green
  } else if (percentage <= 75) {
    return "#ffc107"; // Yellow
  } else {
    return "#f44336"; // Red
  }
}

// Handle form submission to add a new transaction
function addNewTransaction(event) {
  event.preventDefault(); // Prevent page reload on form submission

  // Get form values
  const category = document.getElementById("transaction-category").value;
  const description = document.getElementById("transaction-description").value;
  let amount = parseFloat(document.getElementById("transaction-amount").value);

  if (isNaN(amount) || amount === 0) {
    alert("Amount must be a valid number and cannot be zero.");
    return;
  }

  // Ensure the amount is negative for non-Income categories
  if (category !== "Income") {
    amount = -Math.abs(amount);
  } else {
    amount = Math.abs(amount); // Ensure positive for Income
  }

  // Get the current date in YYYY-MM-DD format
  const currentDate = new Date().toISOString().split("T")[0];

  // Add the new transaction to the centralized array
  transactions.push({
    id: transactions.length + 1,
    date: currentDate,
    category,
    description,
    amount,
  });

  // Re-render both sections
  renderAccountOverview();
  renderBudgetingProgress();

  // Reset the form
  document.getElementById("add-transaction-form").reset();
  updateDashboard(); // Refresh all sections and trigger notifications

}
// Fetch AI advice based on current expenses and budget goals
async function fetchAIAdvice() {
  const expenses = calculateCurrentExpenses();
  const income = budgetGoals.income; // Hardcoded income goal
  const totalExpenses = Object.values(expenses).reduce((acc, val) => acc + val, 0);
  const balance = income - totalExpenses;

  const payload = {
    income,
    expenses,
    budget_goals: budgetGoals,
    balance,
  };

  try {
    const response = await fetch("http://127.0.0.1:5000/get-advice", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    });

    if (response.ok) {
      const result = await response.json();
      document.getElementById("advice-text").innerText = result.advice;
    } else {
      document.getElementById("advice-text").innerText =
        "Error fetching AI advice. Please try again.";
    }
  } catch (error) {
    console.error("Error:", error);
    document.getElementById("advice-text").innerText =
      "Failed to connect to the server.";
  }
}


// Load goals and render charts on page load
window.addEventListener("load", () => {
  loadBudgetGoals(); // Load saved budget goals
  renderAccountOverview(); // Render Account Overview
  renderBudgetingProgress(); // Render charts
});


        </script>
          
    </section>

    <!-- Loan Calculator Section -->
    <section id="calculator-section" class="py-16 px-6 bg-gradient-to-b from-gray-800 to-black text-white">
        <div class="max-w-3xl mx-auto bg-gray-900 p-8 rounded-lg shadow-lg hover:shadow-xl transition">
          <h2 class="text-5xl font-extrabold text-center text-blue-500 mb-8">Loan Repayment Calculator</h2>
          <form id="loanForm" onsubmit="calculateLoan(event)" class="space-y-6">
            <!-- Loan Amount -->
            <div>
              <label for="loan-amount" class="block text-sm font-medium">Loan Amount:</label>
              <input type="number" id="loan-amount" name="loan-amount" placeholder="Enter loan amount" required
                class="w-full p-3 bg-gray-700 text-white rounded focus:ring focus:ring-blue-500">
            </div>
            
            <!-- Annual Interest Rate -->
            <div>
              <label for="interest-rate" class="block text-sm font-medium">Annual Interest Rate (%):</label>
              <input type="number" id="interest-rate" name="interest-rate" step="0.01" placeholder="Enter interest rate (e.g., 3.75)" required
                class="w-full p-3 bg-gray-700 text-white rounded focus:ring focus:ring-blue-500">
            </div>
            
            <!-- Repayment Options -->
            <div>
              <label class="block text-sm font-medium mb-2">Repayment Option:</label>
              <div class="flex items-center space-x-4">
                <div>
                  <input type="radio" id="option-term" name="repayment-option" value="term" checked
                    class="text-blue-500 focus:ring focus:ring-blue-500">
                  <label for="option-term" class="text-gray-300">Specify Loan Term (years)</label>
                </div>
                <div>
                  <input type="radio" id="option-payment" name="repayment-option" value="payment"
                    class="text-blue-500 focus:ring focus:ring-blue-500">
                  <label for="option-payment" class="text-gray-300">Specify Desired Monthly Payment</label>
                </div>
              </div>
            </div>
            
            <!-- Loan Term Input -->
            <div id="term-input" class="mt-4">
              <label for="loan-term" class="block text-sm font-medium">Loan Term (years):</label>
              <input type="number" id="loan-term" name="loan-term" placeholder="Enter loan term in years"
                class="w-full p-3 bg-gray-700 text-white rounded focus:ring focus:ring-blue-500">
            </div>
            
            <!-- Monthly Payment Input -->
            <div id="payment-input" class="hidden mt-4">
              <label for="monthly-payment" class="block text-sm font-medium">Desired Monthly Payment:</label>
              <input type="number" id="monthly-payment" name="monthly-payment" placeholder="Enter desired monthly payment"
                class="w-full p-3 bg-gray-700 text-white rounded focus:ring focus:ring-blue-500">
            </div>
            
            <!-- Submit Button -->
            <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-full hover:bg-blue-500 transition">
              Calculate Repayment
            </button>
          </form>
          
          <!-- Results Section -->
          <div id="loan-results" class="mt-8 p-6 bg-gray-800 rounded-lg shadow-lg hidden">
            <h3 class="text-3xl font-semibold text-center text-blue-400 mb-4">Results:</h3>
            <div class="space-y-4">
              <p id="monthly-payment-result" class="text-lg font-medium text-gray-300"></p>
              <p id="total-payment-result" class="text-lg font-medium text-gray-300"></p>
              <p id="total-interest-result" class="text-lg font-medium text-gray-300"></p>
            </div>
          </div>
        </div>
      </section>
      <script>
        // Toggle between loan term and desired monthly payment inputs
        function toggleInput() {
          const isTermOption = document.getElementById('option-term').checked;
          document.getElementById('term-input').classList.toggle('hidden', !isTermOption);
          document.getElementById('payment-input').classList.toggle('hidden', isTermOption);
        }
      
        // Calculate loan repayment
        function calculateLoan(event) {
          event.preventDefault();
      
          const loanAmount = parseFloat(document.getElementById('loan-amount').value);
          const annualInterestRate = parseFloat(document.getElementById('interest-rate').value) / 100 / 12;
          const isTermOption = document.getElementById('option-term').checked;
      
          let monthlyPayment, totalPayment, totalInterest, loanTerm;
      
          if (isTermOption) {
            loanTerm = parseFloat(document.getElementById('loan-term').value) * 12;
            monthlyPayment = (loanAmount * annualInterestRate) / (1 - Math.pow(1 + annualInterestRate, -loanTerm));
            totalPayment = monthlyPayment * loanTerm;
            totalInterest = totalPayment - loanAmount;
          } else {
            monthlyPayment = parseFloat(document.getElementById('monthly-payment').value);
            loanTerm = Math.log(1 - (loanAmount * annualInterestRate) / monthlyPayment) / Math.log(1 + annualInterestRate);
            totalPayment = monthlyPayment * loanTerm;
            totalInterest = totalPayment - loanAmount;
          }
      
          document.getElementById('loan-results').classList.remove('hidden');
          document.getElementById('monthly-payment-result').innerText = `Monthly Payment: $${monthlyPayment.toFixed(2)}`;
          document.getElementById('total-payment-result').innerText = `Total Payment: $${totalPayment.toFixed(2)}`;
          document.getElementById('total-interest-result').innerText = `Total Interest: $${totalInterest.toFixed(2)}`;
        }
      
        // Event listener for repayment option change
        document.querySelectorAll('input[name="repayment-option"]').forEach(input => {
          input.addEventListener('change', toggleInput);
        });
      </script>
          <!-- Chatbot Trigger Button -->
  <button id="chatbot-button">Chat</button>

  <!-- Chatbot Container -->
  <div id="chatbot-container">
    <div id="chatbot-header">
      <span>Assistant</span>
      <button onclick="toggleChatbot()" style="color: white; background: none; border: none; cursor: pointer;">&times;</button>
    </div>
    <div id="chatbot-messages"></div>
    <div id="chatbot-input-container">
      <input type="text" id="chatbot-input" placeholder="Type a message..." />
      <button id="chatbot-send">Send</button>
    </div>
  </div>

  <script>
    const chatbotContainer = document.getElementById("chatbot-container");
    const chatbotButton = document.getElementById("chatbot-button");
    const chatbotMessages = document.getElementById("chatbot-messages");
    const chatbotInput = document.getElementById("chatbot-input");
    const chatbotSend = document.getElementById("chatbot-send");

    function toggleChatbot() {
      if (chatbotContainer.style.display === "none" || !chatbotContainer.style.display) {
        chatbotContainer.style.display = "flex";
        chatbotButton.style.display = "none";
      } else {
        chatbotContainer.style.display = "none";
        chatbotButton.style.display = "block";
      }
    }

    chatbotButton.addEventListener("click", toggleChatbot);

    chatbotSend.addEventListener("click", async () => {
      const userMessage = chatbotInput.value.trim();
      if (!userMessage) return;

      // Add user message to the chat
      const userMessageElement = document.createElement("div");
      userMessageElement.style.color = "white";
      userMessageElement.style.marginBottom = "10px";
      userMessageElement.textContent = `You: ${userMessage}`;
      chatbotMessages.appendChild(userMessageElement);

      chatbotInput.value = "";

      // Fetch response from the chatbot
      const response = await fetch("http://127.0.0.1:5000/chatbot", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ message: userMessage }),
      });

      if (response.ok) {
        const data = await response.json();
        const botMessageElement = document.createElement("div");
        botMessageElement.style.color = "#434bb7";
        botMessageElement.style.marginBottom = "10px";
        botMessageElement.textContent = `Assistant: ${data.message}`;
        chatbotMessages.appendChild(botMessageElement);
      } else {
        const errorMessageElement = document.createElement("div");
        errorMessageElement.style.color = "red";
        errorMessageElement.style.marginBottom = "10px";
        errorMessageElement.textContent = "Assistant: Something went wrong. Please try again.";
        chatbotMessages.appendChild(errorMessageElement);
      }

      // Scroll to the latest message
      chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
    });
    function toggleInput() {
        const isTermOption = document.getElementById('option-term').checked;
        document.getElementById('term-input').classList.toggle('hidden', !isTermOption);
        document.getElementById('payment-input').classList.toggle('hidden', isTermOption);
      }
  
      function calculateLoan(event) {
        event.preventDefault();
  
        const loanAmount = parseFloat(document.getElementById('loan-amount').value);
        const annualInterestRate = parseFloat(document.getElementById('interest-rate').value) / 100 / 12;
        const isTermOption = document.getElementById('option-term').checked;
  
        let monthlyPayment, totalPayment, totalInterest, loanTerm;
  
        if (isTermOption) {
          loanTerm = parseFloat(document.getElementById('loan-term').value) * 12;
          monthlyPayment = (loanAmount * annualInterestRate) / (1 - Math.pow(1 + annualInterestRate, -loanTerm));
          totalPayment = monthlyPayment * loanTerm;
          totalInterest = totalPayment - loanAmount;
        } else {
          monthlyPayment = parseFloat(document.getElementById('monthly-payment').value);
          loanTerm = Math.log(1 - (loanAmount * annualInterestRate) / monthlyPayment) / Math.log(1 + annualInterestRate);
          totalPayment = monthlyPayment * loanTerm;
          totalInterest = totalPayment - loanAmount;
        }
  
        document.getElementById('loan-results').classList.remove('hidden');
        document.getElementById('monthly-payment-result').innerText = `Monthly Payment: $${monthlyPayment.toFixed(2)}`;
        document.getElementById('total-payment-result').innerText = `Total Payment: $${totalPayment.toFixed(2)}`;
        document.getElementById('total-interest-result').innerText = `Total Interest: $${totalInterest.toFixed(2)}`;
      }
  </script>
    </section>

    <!-- Community Forum Section -->
    <!-- Community Forum Section -->
    <section id="forum-section" class="py-16 px-8 bg-gradient-to-b from-gray-900 to-black text-white">
        <h2 class="text-5xl font-extrabold text-center text-blue-500 mb-10">Community Forum</h2>
      
        <div class="flex flex-col lg:flex-row gap-8">
          <!-- Sidebar Navigation -->
          <aside class="hidden lg:block w-1/4 bg-gray-800 p-6 rounded-lg shadow-lg hover:shadow-xl transition">
            <h3 class="text-xl font-bold text-blue-400 mb-4">Forum Navigation</h3>
            <ul class="space-y-4">
              <li><a href="#threadForm" class="text-blue-500 hover:underline">Create a New Thread</a></li>
              <li><a href="#threadsContainer" class="text-blue-500 hover:underline">View Threads</a></li>
            </ul>
          </aside>
      
          <!-- Main Forum Section -->
          <main class="flex-1">
            <!-- Thread Creation Form -->
            <div id="threadForm" class="bg-gray-800 p-8 rounded-lg shadow-lg hover:shadow-xl transition">
              <h3 class="text-2xl font-semibold mb-6">Create a New Thread</h3>
              <form onsubmit="handleThreadSubmit(event)">
                <!-- Thread Title -->
                <div class="mb-6">
                  <label for="thread-title" class="block text-sm font-medium mb-2">Title:</label>
                  <input type="text" id="thread-title" name="title" placeholder="Enter thread title" required
                    class="w-full p-3 bg-gray-700 rounded focus:ring focus:ring-blue-500">
                </div>
                <!-- Thread Description -->
                <div class="mb-6">
                  <label for="thread-description" class="block text-sm font-medium mb-2">Description:</label>
                  <textarea id="thread-description" name="description" placeholder="Enter thread description" required
                    class="w-full p-3 bg-gray-700 rounded focus:ring focus:ring-blue-500"></textarea>
                </div>
                <!-- Submit Button -->
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-full hover:bg-blue-500 transition">
                  Submit Thread
                </button>
              </form>
            </div>
      
            <!-- Threads and Replies -->
            <div id="threadsContainer" class="mt-10 space-y-8">
              <!-- Placeholder for dynamically added threads -->
            </div>
      
            <!-- Modal for Thread Details -->
            <div id="threadModal" class="fixed inset-0 hidden bg-black bg-opacity-70 flex justify-center items-center z-50">
              <div class="bg-gray-800 p-8 rounded-lg shadow-lg w-11/12 md:w-2/3">
                <h3 id="modalThreadTitle" class="text-xl font-bold text-blue-400"></h3>
                <p id="modalThreadDescription" class="text-gray-300 mt-4 mb-6"></p>
                <div>
                  <h4 class="text-lg font-semibold text-blue-500 mb-4">Replies</h4>
                  <div id="modalReplies" class="space-y-4">
                    <!-- Replies will be dynamically added here -->
                  </div>
                </div>
                <form id="modalReplyForm" class="mt-6">
                  <textarea id="modalReplyInput" placeholder="Add a reply..." required
                    class="w-full p-3 bg-gray-700 rounded focus:ring focus:ring-blue-500 mb-4"></textarea>
                  <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-full hover:bg-blue-500 transition">
                    Submit Reply
                  </button>
                </form>
                <button class="mt-4 w-full bg-red-600 text-white py-2 rounded-full hover:bg-red-500 transition"
                  onclick="closeThreadModal()">Close</button>
              </div>
            </div>
          </main>
        </div>
      </section>
      
      
    </main>
  
    <!-- JavaScript -->
    <script>
      // Function to show a section and store the selected tab in localStorage
// Function to show a section and store the selected tab in localStorage
function showSection(sectionId) {
  // Hide all sections
  document.querySelectorAll('main > section').forEach((section) => section.classList.add('hidden-section'));

  // Remove the active-tab class from all buttons
  document.querySelectorAll('nav button').forEach((button) => button.classList.remove('active-tab'));

  // Show the selected section and activate the corresponding tab
  const section = document.getElementById(`${sectionId}-section`);
  const tab = document.getElementById(`${sectionId}-tab`);

  if (section && tab) {
    section.classList.remove('hidden-section');
    tab.classList.add('active-tab');
  }

  // Save the current tab in localStorage
  localStorage.setItem('activeTab', sectionId);
}

// Function to load the last active tab on page load
function loadLastActiveTab() {
  const savedTab = localStorage.getItem('activeTab');
  if (savedTab) {
    showSection(savedTab);
  } else {
    // Default to the overview section if no tab is saved
    showSection('overview');
  }
}

// Add event listeners for all tabs
document.getElementById('overview-tab').addEventListener('click', () => showSection('overview'));
document.getElementById('budgeting-tab').addEventListener('click', () => showSection('budgeting'));
document.getElementById('calculator-tab').addEventListener('click', () => showSection('calculator'));
document.getElementById('forum-tab').addEventListener('click', () => showSection('forum'));

// Load the last active tab on page load
window.onload = loadLastActiveTab;



  
      // Forum Functionality
      const apiUrl = 'http://localhost:5003/api/threads';

// Fetch and display threads
async function fetchThreads() {
  try {
    const response = await fetch(apiUrl);
    const threads = await response.json();
    renderThreads(threads);
  } catch (error) {
    console.error('Error fetching threads:', error);
  }
}

// Render threads and replies
function renderThreads(threads) {
const threadsContainer = document.getElementById('threadsContainer');
threadsContainer.innerHTML = ''; // Clear existing threads

threads.forEach((thread) => {
const threadElement = document.createElement('div');
threadElement.classList.add('bg-gray-800', 'p-6', 'rounded-lg', 'shadow-md', 'interactive', 'text-white');

threadElement.innerHTML = `
  <h3 class="text-xl font-semibold text-blue-400">${thread.title}</h3>
  <p class="text-gray-300 my-2" style="white-space: pre-wrap; overflow-wrap: break-word;">
    ${thread.description}
  </p>
  <div class="mt-4 space-y-4">
    <h4 class="text-lg font-semibold text-blue-500">Replies</h4>
    <div id="replies-${thread.id}" class="space-y-2">
      ${thread.replies.map((reply) => `
        <p class="bg-gray-700 p-3 rounded shadow text-gray-300">- ${reply.reply}</p>
      `).join('')}
    </div>
    <form data-thread-id="${thread.id}" class="replyForm mt-4 space-y-2">
      <textarea 
        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
        placeholder="Add a reply..." 
        required></textarea>
      <button 
        type="submit" 
        class="mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
        Submit Reply
      </button>
    </form>
  </div>
`;

threadsContainer.appendChild(threadElement);
});

document.querySelectorAll('.replyForm').forEach((form) => {
form.addEventListener('submit', handleReplySubmit);
});
}


// Handle thread submission
async function handleThreadSubmit(event) {
  event.preventDefault();
  const title = document.getElementById('thread-title').value;
  const description = document.getElementById('thread-description').value;

  try {
    const response = await fetch(apiUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ title, description }),
    });

    if (response.ok) {
      document.getElementById('threadForm').reset();
      fetchThreads();
    } else {
      const errorData = await response.json();
      alert(errorData.error || 'Failed to submit thread.');
    }
  } catch (error) {
    console.error('Error submitting thread:', error);
  }
}

// Handle reply submission
async function handleReplySubmit(event) {
  event.preventDefault();
  const form = event.target;
  const threadId = form.getAttribute('data-thread-id');
  const reply = form.querySelector('textarea').value;

  try {
    const response = await fetch(`${apiUrl}/${threadId}/replies`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ reply }),
    });

    if (response.ok) {
      form.reset();
      fetchThreads();
    } else {
      const errorData = await response.json();
      alert(errorData.error || 'Failed to submit reply.');
    }
  } catch (error) {
    console.error('Error submitting reply:', error);
  }
}

// Initialize
document.getElementById('threadForm').addEventListener('submit', handleThreadSubmit);
fetchThreads();

    </script>
<!-- Footer Section -->
<footer class="bg-black text-white py-6 flex justify-center">
    <button
      onclick="goToMainPage()"
      class="px-6 py-3 bg-blue-600 text-white rounded-full hover:bg-blue-500 transition"
    >
      Back to Main Page
    </button>
  </footer>
  
  <!-- JavaScript -->
  <script>
    function goToMainPage() {
      // Redirect to the main page
      window.location.href = "index.html"; // Replace with the URL of your main page
    }
   // Show notification with a message and type
   function showNotification(message, type = "info") {
  const container = document.getElementById("notification-container");

  // Create a unique key for the notification
  const notificationKey = `${type}:${message}`;

  // Check if the notification was already shown (in memory or localStorage)
  if (activeNotifications.has(notificationKey)) return;

  const shownNotifications = JSON.parse(localStorage.getItem("shownNotifications")) || [];
  if (shownNotifications.includes(notificationKey)) return;

  // Add the notification to active and persistent storage
  activeNotifications.add(notificationKey);
  shownNotifications.push(notificationKey);
  localStorage.setItem("shownNotifications", JSON.stringify(shownNotifications));

  // Create and display the notification
  const notification = document.createElement("div");
  notification.className = `notification ${type}`;
  notification.innerText = message;

  container.appendChild(notification);

  // Remove the notification after 5 seconds
  setTimeout(() => {
    container.removeChild(notification);
    activeNotifications.delete(notificationKey);
  }, 5000);
}



// Check notifications for funds and goals
function checkNotifications() {
  const totalIncome = parseFloat(
    document.getElementById("total-income").textContent.replace("€", "")
  );
  const totalExpenses = parseFloat(
    document.getElementById("total-expenses").textContent.replace("€", "")
  );
  const remainingBalance = parseFloat(
    document.getElementById("remaining-balance").textContent.replace("€", "")
  );

  if (remainingBalance <= totalIncome / 2 && remainingBalance > 100) {
    showNotification(
      "Warning: Half of your funds have been used. Monitor your expenses carefully.",
      "warning"
    );
  }

  if (remainingBalance <= 100) {
    showNotification(
      "Danger: Your remaining funds are critically low! Take action to avoid financial trouble.",
      "danger"
    );
  }

  checkBudgetGoals();
}


// Check budget goal notifications
function checkBudgetGoals() {
  const expenses = calculateCurrentExpenses();

  for (const [category, spent] of Object.entries(expenses)) {
    if (["income", "rent"].includes(category)) continue; // Skip income and rent

    const goal = budgetGoals[category] || 0;
    if (goal > 0) {
      const percentage = (spent / goal) * 100;

      // Notify based on percentage
      if (percentage >= 50 && percentage < 75) {
        showNotification(
          `Warning: You have used ${percentage.toFixed(
            1
          )}% of your budget for ${category}.`,
          "warning"
        );
      } else if (percentage >= 75) {
        showNotification(
          `Danger: You have used ${percentage.toFixed(
            1
          )}% of your budget for ${category}. Take action immediately!`,
          "danger"
        );
      }
    }
  }
}
function updateDashboard() {
  renderAccountOverview();
  renderBudgetingProgress();
  checkNotifications(); // Call notifications only once
}

// Call updateDashboard instead of individual rendering functions
window.addEventListener("load", () => {
  loadBudgetGoals(); // Load saved budget goals
  updateDashboard(); // Update entire dashboard
});
// Function to reset notifications
function resetNotifications() {
  // Clear active notifications in memory
  activeNotifications.clear();

  // Clear localStorage tracking for shown notifications
  localStorage.removeItem("shownNotifications");

  // Clear the notification container
  const container = document.getElementById("notification-container");
  container.innerHTML = "";

  alert("Notifications have been reset.");
}

// Attach reset functionality to the button
document.getElementById("reset-notifications").addEventListener("click", resetNotifications);


  </script>
  
  
</body>
</html>
