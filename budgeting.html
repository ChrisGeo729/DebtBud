<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Take control of your finances with our budgeting tools.">
    <title>Budgeting Section</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
</head>
<body class="font-sans bg-gray-900 text-white">

    <header id="navbar" class="flex items-center justify-between px-6 py-4 fixed w-full top-0 z-50 transition-colors duration-300 bg-transparent text-white">
        <!-- Logo and Name -->
        <a href="index.html" class="flex items-center space-x-3">
          <img src="assets/unnamed-removebg-preview.png" alt="DebtBud Logo" class="w-8 h-8">
          <span class="text-xl font-semibold">DebtBud</span>
        </a>
      
        <!-- Right Section: Buttons and Menu -->
        <div class="flex items-center space-x-4">
            <!-- Sign Up Button -->
          <button onclick="window.location.href='signup.html'" class="px-4 py-2 text-sm font-semibold bg-blue-500 text-white rounded-full hover:bg-blue-600 transition">
            Sign Up
          </button>
          <!-- Log In Button -->
          <button onclick="window.location.href='login.html'" class="px-4 py-2 text-sm font-semibold bg-transparent border border-white rounded-full hover:bg-white hover:text-black transition">
            Log In
          </button>
          <!-- Try Demo Button
          <button onclick="window.location.href='demo.html'" class="px-4 py-2 text-sm text-green-600 font-semibold bg-transparent border border-green-600 rounded-full hover:bg-green-600 hover:text-white transition">
            Try Demo
          </button> -->
      
          <!-- Menu Button -->
          <button id="menuButton" class="flex items-center justify-center w-10 h-10 rounded-full bg-black hover:bg-gray-900">
            <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
            </svg>
          </button>
        </div>
      </header>
      <script>
        // Get the navbar element
    const navbar = document.getElementById('navbar');
    
    // Listen to the scroll event
    window.addEventListener('scroll', () => {
      // Get the scroll position
      const scrollPosition = window.scrollY;
    
      // Change the background transparency based on scroll position
      if (scrollPosition > 50) {
        navbar.classList.remove('bg-transparent');
        navbar.classList.add('bg-black', 'bg-opacity-90');
      } else {
        navbar.classList.remove('bg-black', 'bg-opacity-90');
        navbar.classList.add('bg-transparent');
      }
    });
    
      </script>
      
    
      <!-- Navigation Overlay -->
      <div id="navOverlay" class="fixed inset-0 bg-black bg-opacity-95 text-white flex flex-col items-center justify-center space-y-8 hidden z-50">
        <button id="closeButton" class="absolute top-6 right-6 text-white text-3xl">
          &times;
        </button>
        <a href="index.html" class="text-2xl font-bold hover:text-blue-500">Home</a>
        <a href="budgeting.html" class="text-2xl font-bold hover:text-blue-500">Budgeting</a>
        <a href="loan_calculator.html" class="text-2xl font-bold hover:text-blue-500">Calculator</a>
        <a href="connect.html" class="text-2xl font-bold hover:text-blue-500">Connect</a>
        <a href="#contact" class="text-2xl font-bold hover:text-blue-500">Contact</a>
      </div>
      

      <section id="budgeting" class="py-16 px-8 bg-black text-white">
        <h2 class="text-5xl font-bold text-center text-blue-600 mb-10">Budgeting Tools</h2>
      
        <!-- Grid Layout for Top Sections -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Left: Forms -->
          <div class="space-y-6">
            <!-- Budget Goals Form -->
            <div id="goals-section" class="bg-gray-900 p-6 rounded-lg shadow-lg">
              <h3 class="text-xl font-semibold text-center text-white mb-4">Enter Your Budget Goals</h3>
              <form id="goalsForm" onsubmit="submitGoals(event)" class="space-y-4">
                <div>
                  <label for="income-goal" class="block font-medium text-gray-300">Monthly Income Goal:</label>
                  <input type="number" id="income-goal" name="income-goal" required
                    class="w-full p-2 bg-gray-800 text-white border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label for="rent-goal" class="block font-medium text-gray-300">Rent Goal:</label>
                  <input type="number" id="rent-goal" name="rent-goal" required
                    class="w-full p-2 bg-gray-800 text-white border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label for="groceries-goal" class="block font-medium text-gray-300">Groceries Goal:</label>
                  <input type="number" id="groceries-goal" name="groceries-goal" required
                    class="w-full p-2 bg-gray-800 text-white border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label for="entertainment-goal" class="block font-medium text-gray-300">Entertainment Goal:</label>
                  <input type="number" id="entertainment-goal" name="entertainment-goal" required
                    class="w-full p-2 bg-gray-800 text-white border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label for="transportation-goal" class="block font-medium text-gray-300">Transportation Goal:</label>
                  <input type="number" id="transportation-goal" name="transportation-goal" required
                    class="w-full p-2 bg-gray-800 text-white border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label for="savings-goal" class="block font-medium text-gray-300">Savings Goal:</label>
                  <input type="number" id="savings-goal" name="savings-goal" required
                    class="w-full p-2 bg-gray-800 text-white border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button type="submit"
                  class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-500 transition">Save Goals</button>
              </form>
            </div>
      
            <!-- Current Expenses Form -->
            <div id="expenses-section" class="bg-gray-900 p-6 rounded-lg shadow-lg hidden">
              <h3 class="text-xl font-semibold text-center text-white mb-4">Enter Your Current Expenses</h3>
              <form id="expensesForm" onsubmit="submitExpenses(event)" class="space-y-4">
                <div>
                  <label for="income" class="block font-medium text-gray-300">Monthly Income:</label>
                  <input type="number" id="income" name="income" required
                    class="w-full p-2 bg-gray-800 text-white border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label for="rent" class="block font-medium text-gray-300">Rent:</label>
                  <input type="number" id="rent" name="rent" required
                    class="w-full p-2 bg-gray-800 text-white border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label for="groceries" class="block font-medium text-gray-300">Groceries:</label>
                  <input type="number" id="groceries" name="groceries" required
                    class="w-full p-2 bg-gray-800 text-white border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label for="entertainment" class="block font-medium text-gray-300">Entertainment:</label>
                  <input type="number" id="entertainment" name="entertainment" required
                    class="w-full p-2 bg-gray-800 text-white border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label for="transportation" class="block font-medium text-gray-300">Transportation:</label>
                  <input type="number" id="transportation" name="transportation" required
                    class="w-full p-2 bg-gray-800 text-white border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label for="savings" class="block font-medium text-gray-300">Savings:</label>
                  <input type="number" id="savings" name="savings" required
                    class="w-full p-2 bg-gray-800 text-white border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button type="submit"
                  class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600 transition">Submit Expenses</button>
              </form>
            </div>
          </div>
      
          <!-- AI Advice -->
          <div id="advice-output" class="bg-gray-900 p-6 rounded-lg shadow-lg">
            <h3 class="text-xl font-semibold text-white">AI Advice</h3>
            <p id="advice-text" class="text-gray-300 mt-4">Your advice will appear here after submitting expenses.</p>
          </div>
        </div>
      
        <!-- Bottom Section: Chart -->
        <div id="charts-container" class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-8">
            <!-- Row 1 -->
            <div class="flex flex-col items-center bg-gray-800 p-4 rounded-lg shadow w-full">
                <p id="chart-income-title" class="text-white font-bold mb-2">Income</p>
                <canvas id="chart-income" class="w-full h-auto" style="max-width: 250px; max-height: 250px;"></canvas>
            </div>
            <div class="flex flex-col items-center bg-gray-800 p-4 rounded-lg shadow w-full">
                <p id="chart-rent-title" class="text-white font-bold mb-2">Rent</p>
                <canvas id="chart-rent" class="w-full h-auto" style="max-width: 250px; max-height: 250px;"></canvas>
            </div>
            <div class="flex flex-col items-center bg-gray-800 p-4 rounded-lg shadow w-full">
                <p id="chart-groceries-title" class="text-white font-bold mb-2">Groceries</p>
                <canvas id="chart-groceries" class="w-full h-auto" style="max-width: 250px; max-height: 250px;"></canvas>
            </div>
            <!-- Row 2 -->
            <div class="flex flex-col items-center bg-gray-800 p-4 rounded-lg shadow w-full">
                <p id="chart-entertainment-title" class="text-white font-bold mb-2">Entertainment</p>
                <canvas id="chart-entertainment" class="w-full h-auto" style="max-width: 250px; max-height: 250px;"></canvas>
            </div>
            <div class="flex flex-col items-center bg-gray-800 p-4 rounded-lg shadow w-full">
                <p id="chart-transportation-title" class="text-white font-bold mb-2">Transportation</p>
                <canvas id="chart-transportation" class="w-full h-auto" style="max-width: 250px; max-height: 250px;"></canvas>
            </div>
            <div class="flex flex-col items-center bg-gray-800 p-4 rounded-lg shadow w-full">
                <p id="chart-savings-title" class="text-white font-bold mb-2">Savings</p>
                <canvas id="chart-savings" class="w-full h-auto" style="max-width: 250px; max-height: 250px;"></canvas>
            </div>
        </div>
        
        
      

    <!-- Include Chart.js for the chart rendering -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- JavaScript Code -->
    <script>
        let budgetGoals = {};

// Handle the submission of budget goals
function submitGoals(event) {
    event.preventDefault();
    budgetGoals = {
        income: parseFloat(document.getElementById('income-goal').value) || 0,
        rent: parseFloat(document.getElementById('rent-goal').value) || 0,
        groceries: parseFloat(document.getElementById('groceries-goal').value) || 0,
        entertainment: parseFloat(document.getElementById('entertainment-goal').value) || 0,
        transportation: parseFloat(document.getElementById('transportation-goal').value) || 0,
        savings: parseFloat(document.getElementById('savings-goal').value) || 0
    };

    document.getElementById('goals-section').classList.add('hidden');
    document.getElementById('expenses-section').classList.remove('hidden');
}

async function submitExpenses(event) {
    event.preventDefault();

    const income = parseFloat(document.getElementById('income').value);
    const expenses = {
        rent: parseFloat(document.getElementById('rent').value),
        groceries: parseFloat(document.getElementById('groceries').value),
        entertainment: parseFloat(document.getElementById('entertainment').value),
        transportation: parseFloat(document.getElementById('transportation').value),
        savings: parseFloat(document.getElementById('savings').value)
    };

    try {
        const response = await fetch('http://127.0.0.1:5000/get-advice', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ income, expenses, budgetGoals })
        });

        if (response.ok) {
            const result = await response.json();
            document.getElementById('advice-text').innerText = result.advice;
            updateProgressCharts(expenses);
        } else {
            document.getElementById('advice-text').innerText = 'Error fetching advice. Please try again.';
        }
    } catch (error) {
        console.error("Error:", error);
        document.getElementById('advice-text').innerText = 'Failed to connect to the server.';
    }
}

function getColorByPercentage(percentage) {
    if (percentage <= 9) {
        return '#2563eb'; // Blue for 0-9%
    } else if (percentage <= 49) {
        return '#4caf50'; // Green for 10-49%
    } else if (percentage <= 75) {
        return '#ffc107'; // Yellow for 50-75%
    } else {
        return '#f44336'; // Red for 76-100%
    }
}

function updateProgressCharts(expenses) {
    const categories = Object.keys(budgetGoals);

    categories.forEach((category) => {
        const goal = budgetGoals[category];
        const spent = expenses[category] || 0;

        let percentage, remaining;

        if (category === 'income') {
            // Special calculation for income
            const totalExpenses = Object.keys(expenses).reduce((sum, key) => sum + (expenses[key] || 0), 0);
            percentage = Math.round((totalExpenses / goal) * 100);
            remaining = 100 - percentage;
        } else {
            // Default calculation for other categories
            percentage = Math.round((spent / goal) * 100);
            remaining = 100 - percentage;
        }

        const color = getColorByPercentage(percentage);
        const canvasId = `chart-${category}`;
        const ctx = document.getElementById(canvasId)?.getContext('2d');

        if (!ctx) return;

        // Update the chart title with the percentage
        const titleElement = document.querySelector(`#chart-${category}-title`);
        if (titleElement) {
            titleElement.innerHTML = `${category.charAt(0).toUpperCase() + category.slice(1)} (${percentage}%)`;
        }

        // Destroy any existing chart before rendering a new one
        if (ctx.chart) {
            ctx.chart.destroy();
        }

        ctx.chart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [percentage, remaining],
                    backgroundColor: [color, '#e0e0e0'],
                    hoverBackgroundColor: [color, '#e0e0e0']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                cutout: '75%', // Smaller size
                plugins: {
                    legend: { display: false }
                }
            }
        });
    });
}


    </script>
    <footer class="bg-black text-white text-center py-4">
        <p class="text-sm">© 2024 DebtBud. All rights reserved.</p>
      </footer>
      <script>
        const menuButton = document.getElementById('menuButton');
        const closeButton = document.getElementById('closeButton');
        const navOverlay = document.getElementById('navOverlay');
    
        // Open the navigation overlay
        menuButton.addEventListener('click', () => {
        navOverlay.classList.remove('hidden');
        });
    
        // Close the navigation overlay
        closeButton.addEventListener('click', () => {
        navOverlay.classList.add('hidden');
        });
    
      </script>
</body>
</html>
