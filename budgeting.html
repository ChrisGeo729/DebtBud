<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Take control of your finances with our budgeting tools.">
    <title>Budgeting Section</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Additional CSS for smaller chart and layout */
        .chart-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        canvas {
            width: 400px !important; /* Smaller width */
            height: 400px !important; /* Smaller height */
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        .legend p {
            font-size: 0.9rem;
            margin: 0;
        }
    </style>
</head>
<body>

    <!-- Header Section -->
    <header>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="budgeting.html">Budgeting Section</a></li>
                <li><a href="#calculator">Loan Repayment Calculator</a></li>
                <li><a href="#connect">Connect with Others</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- Budgeting Section -->
    <section id="budgeting">
        <h2>Budgeting Section</h2>
        <form id="budgetForm" onsubmit="submitBudget(event)">
            <label for="income">Income:</label>
            <input type="number" id="income" name="income" required>

            <label for="rent">Rent:</label>
            <input type="number" id="rent" name="rent" required>

            <label for="groceries">Groceries:</label>
            <input type="number" id="groceries" name="groceries" required>

            <label for="entertainment">Entertainment:</label>
            <input type="number" id="entertainment" name="entertainment" required>

            <label for="transportation">Transportation:</label>
            <input type="number" id="transportation" name="transportation" required>

            <label for="savings">Savings:</label>
            <input type="number" id="savings" name="savings" required>

            <button type="submit">Get AI Advice</button>
        </form>

        <div id="advice-output"></div>

        <!-- Circular Progress Chart container -->
        <div class="chart-container">
            <canvas id="budgetProgressChart"></canvas>
            <div class="legend">
                <p><span style="color: #FF6384;">●</span> Rent</p>
                <p><span style="color: #36A2EB;">●</span> Groceries</p>
                <p><span style="color: #FFCE56;">●</span> Entertainment</p>
                <p><span style="color: #4BC0C0;">●</span> Transportation</p>
                <p><span style="color: #9966FF;">●</span> Savings</p>
            </div>
        </div>
    </section>

    <!-- Include Chart.js for the chart rendering -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- JavaScript to handle form submission and display the progress chart -->
    <script>
        async function submitBudget(event) {
            event.preventDefault();

            const income = document.getElementById('income').value;
            const expenses = {
                rent: parseFloat(document.getElementById('rent').value),
                groceries: parseFloat(document.getElementById('groceries').value),
                entertainment: parseFloat(document.getElementById('entertainment').value),
                transportation: parseFloat(document.getElementById('transportation').value),
                savings: parseFloat(document.getElementById('savings').value)
            };

            try {
                const response = await fetch('http://127.0.0.1:5000/get-advice', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ income, expenses })
                });

                if (response.ok) {
                    const result = await response.json();
                    document.getElementById('advice-output').innerText = result.advice;
                    updateProgressChart(expenses);
                } else {
                    document.getElementById('advice-output').innerText = 'Error fetching advice. Please try again.';
                }
            } catch (error) {
                console.error("Error:", error);
                document.getElementById('advice-output').innerText = 'Failed to connect to the server.';
            }
        }

        // Initialize chart variable
        let budgetProgressChart;

        function updateProgressChart(expenses) {
            const budgetGoals = {
                rent: 700,
                groceries: 300,
                entertainment: 150,
                transportation: 100,
                savings: 200,
            };

            const data = Object.keys(budgetGoals).map(category => Math.round((expenses[category] / budgetGoals[category]) * 100));
            const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'];

            const ctx = document.getElementById('budgetProgressChart').getContext('2d');

            if (budgetProgressChart) {
                budgetProgressChart.destroy();
            }

            budgetProgressChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(budgetGoals),
                    datasets: data.map((value, index) => ({
                        data: [value, 100 - value],
                        backgroundColor: [colors[index], '#e0e0e0'],
                        hoverBackgroundColor: [colors[index], '#e0e0e0'],
                        borderWidth: 3,
                        circumference: 270,
                        rotation: 0
                    }))
                },
                options: {
                    responsive: true,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw}% of budget used`;
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
