<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Take control of your finances with our budgeting tools.">
    <title>Budgeting Section</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
</head>
<body class="font-sans bg-gray-50 text-gray-800">

    <header class="flex items-center justify-between p-4 bg-blue-800 text-white">
        <!-- Logo -->
        <a href="index.html" class="flex items-center space-x-2">
            <img src="assets/unnamed-removebg-preview.png" alt="DebtBud Logo" class="w-10 h-10">
            <span class="text-xl font-bold">DebtBud</span>
          </a>
      
        <!-- Menu Button -->
        <button id="menuButton" class="flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
          <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
          </svg>
        </button>
      </header>
      
      <!-- Navigation Overlay -->
    <div id="navOverlay" class="fixed inset-0 bg-blue-800 bg-opacity-95 text-white flex flex-col items-center justify-center space-y-8 z-50 hidden">
        <button id="closeButton" class="absolute top-4 right-4 text-2xl">
        &times;
        </button>
        <a href="index.html" class="text-2xl font-bold hover:underline">Home</a>
        <a href="budgeting.html" class="text-2xl font-bold hover:underline">Budgeting</a>
        <a href="loan_calculator.html" class="text-2xl font-bold hover:underline">Calculator</a>
        <a href="connect.html" class="text-2xl font-bold hover:underline">Connect</a>
        <a href="#contact" class="text-2xl font-bold hover:underline">Contact</a>
    </div>
      

    <!-- Budgeting Section -->
    <section id="budgeting" class="p-8">
        <h2 class="text-3xl font-bold text-center text-blue-800 mb-6">Budgeting Section</h2>

        <!-- Grid Layout for Top Sections -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Left: Forms -->
            <div class="space-y-6">
                <!-- Budget Goals Form -->
                <div id="goals-section" class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-center text-gray-800 mb-4">Enter Your Budget Goals</h3>
                    <form id="goalsForm" onsubmit="submitGoals(event)" class="space-y-4">
                        <div>
                            <label for="income-goal" class="block font-medium text-gray-700">Monthly Income Goal:</label>
                            <input type="number" id="income-goal" name="income-goal" required
                                class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-800">
                        </div>
                        <div>
                            <label for="rent-goal" class="block font-medium text-gray-700">Rent Goal:</label>
                            <input type="number" id="rent-goal" name="rent-goal" required
                                class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-800">
                        </div>
                        <div>
                            <label for="groceries-goal" class="block font-medium text-gray-700">Groceries Goal:</label>
                            <input type="number" id="groceries-goal" name="groceries-goal" required
                                class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-800">
                        </div>
                        <div>
                            <label for="entertainment-goal" class="block font-medium text-gray-700">Entertainment Goal:</label>
                            <input type="number" id="entertainment-goal" name="entertainment-goal" required
                                class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-800">
                        </div>
                        <div>
                            <label for="transportation-goal" class="block font-medium text-gray-700">Transportation Goal:</label>
                            <input type="number" id="transportation-goal" name="transportation-goal" required
                                class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-800">
                        </div>
                        <div>
                            <label for="savings-goal" class="block font-medium text-gray-700">Savings Goal:</label>
                            <input type="number" id="savings-goal" name="savings-goal" required
                                class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-800">
                        </div>
                        <button type="submit"
                            class="w-full bg-blue-800 text-white py-2 rounded hover:bg-blue-900 transition">Save Goals</button>
                    </form>
                </div>

                <!-- Current Expenses Form -->
                <div id="expenses-section" class="bg-white p-6 rounded-lg shadow-md hidden">
                    <h3 class="text-xl font-semibold text-center text-gray-800 mb-4">Enter Your Current Expenses</h3>
                    <form id="expensesForm" onsubmit="submitExpenses(event)" class="space-y-4">
                        <div>
                            <label for="income" class="block font-medium text-gray-700">Monthly Income:</label>
                            <input type="number" id="income" name="income" required
                                class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-800">
                        </div>
                        <div>
                            <label for="rent" class="block font-medium text-gray-700">Rent:</label>
                            <input type="number" id="rent" name="rent" required
                                class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-800">
                        </div>
                        <div>
                            <label for="groceries" class="block font-medium text-gray-700">Groceries:</label>
                            <input type="number" id="groceries" name="groceries" required
                                class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-800">
                        </div>
                        <div>
                            <label for="entertainment" class="block font-medium text-gray-700">Entertainment:</label>
                            <input type="number" id="entertainment" name="entertainment" required
                                class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-800">
                        </div>
                        <div>
                            <label for="transportation" class="block font-medium text-gray-700">Transportation:</label>
                            <input type="number" id="transportation" name="transportation" required
                                class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-800">
                        </div>
                        <div>
                            <label for="savings" class="block font-medium text-gray-700">Savings:</label>
                            <input type="number" id="savings" name="savings" required
                                class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-800">
                        </div>
                        <button type="submit"
                            class="w-full bg-blue-800 text-white py-2 rounded hover:bg-blue-900 transition">Submit Expenses</button>
                    </form>
                </div>
            </div>

            <!-- Right: AI Advice -->
            <div id="advice-output" class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold text-gray-800">AI Advice</h3>
                <p id="advice-text" class="text-gray-600 mt-4"></p>
            </div>
        </div>

        <!-- Bottom Section: Chart -->
        <div class="bg-white p-6 rounded-lg shadow-md mt-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Budget Usage Overview</h3>
            <canvas id="budgetProgressChart" class="w-full max-w-md mx-auto" style="height: 300px;"></canvas>
            <div class="legend mt-4">
                <p><span style="color: #fa5858;">●</span> Income</p>
                <p><span style="color: #6062f7;">●</span> Rent</p>
                <p><span style="color: #4fc04b;">●</span> Groceries</p>
                <p><span style="color: #fffc66;">●</span> Entertainment</p>
                <p><span style="color: #ff60df;">●</span> Transportation</p>
                <p><span style="color: #69ffe6;">●</span> Savings</p>
            </div>
        </div>
    </section>

    <!-- Include Chart.js for the chart rendering -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- JavaScript Code -->
    <script>
        let budgetGoals = {};

// Handle the submission of budget goals
function submitGoals(event) {
    // Prevent the form's default behavior of reloading the page
    event.preventDefault();

    // Fetch values from the input fields and store them in the `budgetGoals` object
    budgetGoals = {
        income: parseFloat(document.getElementById('income-goal').value) || 0,
        rent: parseFloat(document.getElementById('rent-goal').value) || 0,
        groceries: parseFloat(document.getElementById('groceries-goal').value) || 0,
        entertainment: parseFloat(document.getElementById('entertainment-goal').value) || 0,
        transportation: parseFloat(document.getElementById('transportation-goal').value) || 0,
        savings: parseFloat(document.getElementById('savings-goal').value) || 0
    };

    // Debugging: Log the budget goals to confirm they are being captured
    console.log("Budget Goals Saved:", budgetGoals);

    // Hide the goals section and show the expenses section
    document.getElementById('goals-section').classList.add('hidden');
    document.getElementById('expenses-section').classList.remove('hidden');
}


        async function submitExpenses(event) {
            event.preventDefault();

            const income = parseFloat(document.getElementById('income').value);
            const expenses = {
                rent: parseFloat(document.getElementById('rent').value),
                groceries: parseFloat(document.getElementById('groceries').value),
                entertainment: parseFloat(document.getElementById('entertainment').value),
                transportation: parseFloat(document.getElementById('transportation').value),
                savings: parseFloat(document.getElementById('savings').value)
            };

            try {
                const response = await fetch('http://127.0.0.1:5000/get-advice', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ income, expenses, budgetGoals })
                });

                if (response.ok) {
                    const result = await response.json();
                    document.getElementById('advice-output').innerText = result.advice;
                    updateProgressChart(expenses);
                } else {
                    document.getElementById('advice-output').innerText = 'Error fetching advice. Please try again.';
                }
            } catch (error) {
                console.error("Error:", error);
                document.getElementById('advice-output').innerText = 'Failed to connect to the server.';
            }
        }

        let budgetProgressChart;

        function updateProgressChart(expenses) {
    // Calculate percentages for expenses relative to each category goal
    const data = Object.keys(budgetGoals).map(category => {
        if (category === 'income') {
            return 100; // Display income as fully available or 100% of itself
        }
        return Math.round((expenses[category] / budgetGoals[category]) * 100);
    });
    
    const colors = ['#fa5858', '#6062f7', '#4fc04b', '#fffc66', '#ff60df', '#69ffe6'];
    
    // Update legend to include income
    const legendContainer = document.querySelector('.legend');
    legendContainer.innerHTML = ''; // Clear existing legend

    Object.keys(budgetGoals).forEach((category, index) => {
        const percentage = data[index];
        const color = colors[index];
        const legendItem = document.createElement('p');
        legendItem.innerHTML = `<span style="color: ${color};">●</span> ${category.charAt(0).toUpperCase() + category.slice(1)}: ${percentage}%${category !== 'income' ? ' used' : ''}`;
        legendContainer.appendChild(legendItem);

        legendContainer.appendChild(legendItem);
    });

    const ctx = document.getElementById('budgetProgressChart').getContext('2d');

    if (budgetProgressChart) {
        budgetProgressChart.destroy();
    }

    budgetProgressChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: Object.keys(budgetGoals),
            datasets: data.map((value, index) => ({
                data: [value, 100 - value],
                backgroundColor: [colors[index], '#e0e0e0'],
                hoverBackgroundColor: [colors[index], '#e0e0e0'],
                borderWidth: 4,
                circumference: 300,
                rotation: -30
            }))
        },
        options: {
            responsive: true,
            cutout: '70%',
            plugins: {
                legend: {
                    display: false // Hide built-in legend since we have a custom one
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.label}: ${context.raw}% of budget used`;
                        }
                    }
                }
            }
        }
    });
}
    </script>
    <footer class="bg-blue-800 text-white text-center py-4">
        <p class="text-sm">© 2024 DebtBud. All rights reserved.</p>
      </footer>
      <script>
        const menuButton = document.getElementById('menuButton');
        const closeButton = document.getElementById('closeButton');
        const navOverlay = document.getElementById('navOverlay');
    
        // Open the navigation overlay
        menuButton.addEventListener('click', () => {
        navOverlay.classList.remove('hidden');
        });
    
        // Close the navigation overlay
        closeButton.addEventListener('click', () => {
        navOverlay.classList.add('hidden');
        });
    
      </script>
</body>
</html>
